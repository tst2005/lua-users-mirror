<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML><HEAD><TITLE>lua-users wiki: Begin End Proposal</TITLE>
<LINK TYPE="text/css" REL="stylesheet" HREF="../styles/main.css">
</HEAD>
<BODY ><table width="100%" border="0"> <tr><td align=left width="100%"><h1><a href="/cgi-bin/wiki.pl?action=search&amp;string=BeginEndProposal&amp;body=1" title="List pages referring to BeginEndProposal">Begin End Proposal</a></h1></td><td align=right>
    <table cellpadding="0" cellspacing="0" border="0" width="1%">
      <tbody>
        <tr>
            <td><a href="../index.html">
            <img src="../images/nav-logo.png" alt="lua-users home" width="177" height="40" border="0"></a></td>
        </tr>
        <tr>
            <td>
            <table cellpadding="0" cellspacing="0" border="0" width="100%">
                <tbody>
                <tr>
                    <td><img src="../images/nav-elbow.png" alt="" width="48" height="40"></td>
                    <td nowrap valign="middle" width="100%">
                        <a href="../wiki/index.html" class="nav">wiki</a></td>
                </tr>
                </tbody>
            </table>
            </td>
        </tr>
      </tbody>
    </table>
<form method="post" action="../wiki/FindPage.html" enctype="application/x-www-form-urlencoded" style="display:inline; margin:0;">
<input type="hidden" name="action" value="search"  /><input type="text" name="string"  size="20" style="" id="search_query1" /><input type="hidden" name="title" value="1"  /><input type="submit" name=".submit" value="Search" /><input type="hidden" name="body" value="on"  /></form></td></tr> </table>
<br clear=all>
This is a formal proposal I wrote up. Let me know what you think, but please don't modify the text of the proposal itself. -- <a href="../wiki/LeafStorm.html" >LeafStorm</a>
<p>
<DL>
<dt><dd><em>This is not a reasonable policy for a public wiki page.  Please change it or move the content to a read-only location on the web.  --<a href="../wiki/JohnBelmonte.html" >JohnBelmonte</a></em>
</DL>
<p>
<H2>Abstract</H2>
<p>
This is a proposal for the addition of 'begin/end' syntax for anonymous, zero-argument functions, aka "procs". For example, this:
<p>
<DL>
<dt><dd><pre>

begin

  print "Foo!"

end

</pre>
</DL>
<p>
would be effectively transformed into:
<p>
<DL>
<dt><dd><pre class="code">
<span class="keyword">function</span> ()

  <span class="library">print</span> <span class="string">"Foo!"</span>

<span class="keyword">end</span>

</pre>

</DL>
<p>
This could be added in <a href="../wiki/LuaFiveTwo.html" >LuaFiveTwo</a>, or possibly in Six (though admittedly Six is a fairly faraway time frame for a relatively minor feature like this.)
<p>
<p>
<H2>Syntax Details</H2>
<p>
The precise modifications to the syntax could be expressed as:
<p>
<DL>
<dt><dd><pre>

proc ::= 'begin' block 'end'



exp ::= nil | false | true | Number | String | `...Â´ | function | proc | 

    prefixexp | tableconstructor | exp binop exp | unop exp 



args ::= '(' [explist] ')' | tableconstructor | String | proc | function

</pre>
</DL>
<p>
(This adds to the grammar expressed in the Lua 5.1 reference manual.) The 'begin' keyword would be added to the list of keywords, and as such would become unavailable as an identifier.
<p>
When a 'proc' is encountered, a function is created with zero arguments and the block as the body. Any arguments passed to said function are passed as variable arguments, accessible by the ... expression (and the <code>arg</code> table if that functionality remains when this proposal is implemented).
<p>
The other notable modification to the syntax is the ability to pass either a proc or an anonymous function straight to the function without parens, like is currently done with table constructors and the like.
<p>
<p>
<H2>Rationale</H2>
<p>
The current syntax which could generate something like a proc is verbose and unwieldy.
<p>
<DL>
<dt><dd><pre class="code">
<span class="keyword">function</span> ()

  do_stuff()

<span class="keyword">end</span>

</pre>

</DL>
<p>
The new syntax would be much easier to read, easier to type, and easier on people using Lua as a configuration language or DSL. The ability to pass functions and procs to function calls without parens would serve a similar purpose. It would require minimal modifications to the Lua core, and code using procs would treat them no differently than normal functions.
<p>
<p>
<H2>Examples</H2>
<p>
This is an example I thought of. (Of course, there are many other places this could be used.)
<p>
<H3>HTML Generation</H3>
<p>
<DL>
<dt><dd><pre>

doc = html begin    -- 'html' is a function in the local namespace

  head begin        -- 'head' is automatically generated by the environment

    title "Hello, world!"

  end

  body begin

    h1 "Hello, world!"

  end

end

</pre>
</DL>
<p>
<p>
<H2>Backwards-Compatibility Concerns</H2>
<p>
At the bytecode level, this would be completely backwards compatible - procs could generate the same bytecode as the <code>function () ... end</code> syntax.
<p>
Syntactically, the changes would be minimal. The only syntax added that could cause problems with <em>existing</em> code is the addition of <code>begin</code> as a keyword. (The other syntax additions were not even remotely possible before, and should not cause issues with current code.) However, <code>begin</code> isn't a very good identifier - there is precedent in other languages for its use as a keyword, and often <code>start</code> is a better fit in situations where <code>begin</code> could be used.
<p>
<p>
<H2>Alternatives Considered</H2>
<p>
I originally thought of the use of <code>start</code> as a keyword. However, there are major problems with this. First, it is used as an identifier much more often than <code>begin</code>. Second, <code>start</code> has never been used in this setting to my knowledge, but <code>begin</code> has in many languages. Finally, <code>begin</code> sounds better and takes the same number of characters to type.
<p>
Another way to approach this would be to use a delimiter. Using curly braces is not practical, as they are already used by tables - and it would be much more difficult to distinguish tables from code blocks in this case. Square brackets have similar problems, in that it would be too easy to have them confused with long-string delimiters. And angle brackets have never been used
this way before, and could be misconstrued as a binary comparison operator. Parens are just ridiculous. And using words is more of the Lua way.
<p>
<p>
<H2>Publication Notes</H2>
<p>
This proposal was written by <a href="../wiki/LeafStorm.html" >LeafStorm</a>.
<p>
Lua code using syntax introduced in this proposal is written in normal monospace format to avoid confusing the syntax highlighter.
<p>
<em>This is the end of the actual proposal.</em>
<p>
<H2>Comments</H2>
<hr>
<a href="../wiki/RecentChanges.html" >RecentChanges</a> &middot; <a href="/cgi-bin/wiki.pl?action=editprefs" >preferences</a><br>
<a href="/cgi-bin/wiki.pl?action=edit&amp;id=BeginEndProposal" >edit</a> &middot; <a href="/cgi-bin/wiki.pl?action=history&amp;id=BeginEndProposal" >history</a><br>Last edited October 3, 2009 4:14 pm GMT <a href="/cgi-bin/wiki.pl?action=browse&amp;diff=1&amp;id=BeginEndProposal" >(diff)</a>
</body>
</html>