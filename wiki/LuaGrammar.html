<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML><HEAD><TITLE>lua-users wiki: Lua Grammar</TITLE>
<LINK TYPE="text/css" REL="stylesheet" HREF="../styles/main.css">
</HEAD>
<BODY ><table width="100%" border="0"> <tr><td align=left width="100%"><h1><a href="/cgi-bin/wiki.pl?action=search&amp;string=LuaGrammar&amp;body=1" title="List pages referring to LuaGrammar">Lua Grammar</a></h1></td><td align=right>
    <table cellpadding="0" cellspacing="0" border="0" width="1%">
      <tbody>
        <tr>
            <td><a href="../index.html">
            <img src="../images/nav-logo.png" alt="lua-users home" width="177" height="40" border="0"></a></td>
        </tr>
        <tr>
            <td>
            <table cellpadding="0" cellspacing="0" border="0" width="100%">
                <tbody>
                <tr>
                    <td><img src="../images/nav-elbow.png" alt="" width="48" height="40"></td>
                    <td nowrap valign="middle" width="100%">
                        <a href="../wiki/index.html" class="nav">wiki</a></td>
                </tr>
                </tbody>
            </table>
            </td>
        </tr>
      </tbody>
    </table>
<form method="post" action="../wiki/FindPage.html" enctype="application/x-www-form-urlencoded" style="display:inline; margin:0;">
<input type="hidden" name="action" value="search"  /><input type="text" name="string"  size="20" style="" id="search_query1" /><input type="hidden" name="title" value="1"  /><input type="submit" name=".submit" value="Search" /><input type="hidden" name="body" value="on"  /></form></td></tr> </table>
<br clear=all>
This page lists various resources on lexing/parsing/compiling Lua.
<p>
<H3>Lua 5.2 Grammar for javacc</H3>
<a href="http://luaj.cvs.sourceforge.net/viewvc/luaj/luaj-vm/grammar/Lua52.jj?view=markup">[Lua5.2.jj]</a> grammar input to <a href="https://javacc.java.net/">[javacc]</a>, used in Java based lua interpreter <a href="http://sourceforge.net/projects/luaj/">[luaj 3.0]</a>. 
<p>
<H3>Lua 5.2 Parser in Lua</H3>
<a href="https://github.com/stravant/LuaMinify">[LuaMinify]</a> contains a Lua 5.2 parser written in Lua, along with various ways to print out the AST.
<p>
<H3>Lua 5.1 Grammar for javacc</H3>
<a href="http://luaj.cvs.sourceforge.net/viewvc/luaj/luaj-vm/grammar/Lua51.jj?view=markup">[Lua5.1.jj]</a> grammar input to <a href="https://javacc.java.net/">[javacc]</a>, used in Java based lua interpreter <a href="http://sourceforge.net/projects/luaj/">[luaj 2.0]</a>. 
<p>
<H3>Lua 5.1 Grammar for Antlr</H3>
listed in <a href="http://antlr.org/grammar/list">http://antlr.org/grammar/list</a>
<p>
<H3>Lua 5.1 Grammar in the Reference Manual</H3>
<p>
"Section 8 - The Complete Syntax of Lua" of the <em>Lua Reference Manual</em><a href="http://www.lua.org/manual/5.1/manual.html#8">[1]</a> provides an extended BNF grammar (without operator precedences) of Lua 5.1.  For precedence, see <a href="http://www.lua.org/manual/5.1/manual.html#2.5.6">[Section 2.5.6 - Precedence]</a>.
<p>
<H3>Lua 5.1 Grammar in Lemon format</H3>
<p>
This is essentially the same as Lemon<a href="http://www.hwaci.com/sw/lemon/lemon.html">[2]</a> format, except that it permits quoted strings for literal terminals.  See Listing 1 below. 
<p>
<H3>Lua 5.1/5.0 Compiler in C</H3>
<p>
The original C parser of Lua, of course, exists in the source code of the Lua distribution, but it is hand-written in C and not easy to reuse.
<p>
<H3>Lua 5.1 Lexer and Parser in LPeg in Lua</H3>
<p>
<a href="../wiki/LpegRecipes.html" >LpegRecipes</a> list Lua 5.1 lexers and parsers in Lua LPeg.
<p>
<H3>Lua 5.1 Parser in Lua</H3>
<p>
The mlp parser, included in <a href="../wiki/MetaLua.html" >MetaLua</a>, can parse Lua (as well as Lua with syntax extensions) and convert it into an AST.  mlp is built on top of the gg grammar generator, which can build <em>extensible</em> parsers with user-defined grammars.  mlp and gg are written entirely in Lua, and its lexer is based on Yueliang (below).  gg/mlp is used, for example, in <a href="../wiki/MetaLua.html" >MetaLua</a> and <a href="../wiki/LuaToCee.html" >LuaToCee</a>.
<p>
Cheese<a href="http://luaforge.net/projects/cheese/">[3]</a> is a parser generator that uses Parsing Expression Grammars (PEG) as its description formalism and Lua itself as a description language for the parsers. It includes a parser that understands the complete syntax of Lua 5.1.  (The PEG appears to be an effort that predates LPeg.)
<p>
<a href="../wiki/LuaBalanced.html" >LuaBalanced</a> provides some functions that match delimited snippets of Lua code in a string.  It avoids rigorously lexing and parsing the Lua grammar by assuming the Lua code is syntactically correct (which can be verified later using <code>loadstring</code>).
<p>
PenLight<a href="/cgi-bin/wiki.pl?action=edit&amp;id=PenLight" >?</a> provides a Lua lexer only <a href="http://penlight.luaforge.net/#T25">[4]</a><a href="http://penlight.luaforge.net/api/modules/pl.lexer.html">[5]</a> implemented in Lua.
<p>
<H3>Lua 5.1 Compiler in Lua</H3>
<p>
<a href="http://luaforge.net/projects/yueliang/">[Yueliang]</a> implements a full Lua compiler in Lua.  It is a fairly direct port of the Lua C code to Lua.
<p>
<H3>Lua 5.1 Compiler in Parrot</H3>
<p>
Parrot <a href="http://www.parrotcode.org/">[6]</a> contains a compiler, written in Perl5, that compiles Lua 5.1 down to Parrot VM bytecodes (though it's a work in progress).  There is also a web interface to the subversion repository <a href="http://svn.perl.org/viewcvs/parrot/trunk/languages/lua/">[7]</a>.
<p>
See also related efforts:
<p>
<UL>
<li> <a href="http://kjs.home.fmf.nl/parrot/">[Monkey]</a> - an implementation of Lua on Parrot - A Lua to PIR compiler implemented in C
<li> <a href="http://kjs.home.fmf.nl/lua2pir/">[lua2pir]</a> - A Lua bytecode to PIR compiler
</UL>
<p>
<H3>Lua 5.1/5.0 Test Suite</H3>
<p>
Those reimplementing Lua may be interested in the test suite for 5.1 <a href="/lists/lua-l/2006-03/msg00716.html">LuaList:2006-03/msg00716.html</a> and 5.0 <a href="/lists/lua-l/2005-12/msg00312.html">LuaList:2005-12/msg00312.html</a>.
<p>
<H3>Lua 5.0 Parser in Lua - Lua<code></code>Parse</H3>
<p>
In August 2004, Rici Lake announced a new Lua 5.0 parser on the lua mailing list, implemented in Lua: <a href="http://luaparse.luaforge.net/">[LuaParse]</a>.
<p>
<H3>A Lua 5.0 Grammar in Gentle</H3>
<p>
<a href="http://luaforge.net/projects/lua2js/">[Lua2js]</a> contains a complete grammar for Lua 5.0 done with the Gentle<a href="http://gentle.compilertools.net/">[8]</a> compiler construction kit.
<p>
<H3>Lua 5.0 in Parser in Haskell/Parsec</H3>
<p>
The lua-xgettext tool includes a parser in Haskell/Parsec:  <a href="/lists/lua-l/2006-10/msg00609.html">LuaList:2006-10/msg00609.html</a>
<p>
<H3>Lua 5.0 Parser in C++ Spirit</H3>
<p>
A mostly complete C++ parser of Lua 5.0, which is using Spirit from Boost: <a href="http://article.gmane.org/gmane.comp.parsers.spirit.general/4846">http://article.gmane.org/gmane.comp.parsers.spirit.general/4846</a>
<p>
This seems like a nice start for reusing in your own things that need a Lua interpreter in C++. The author has abandoned the project, and the above is the latest version as of February 2004.
In February 2005, I looked at this grammar closer to try to use it. There are a number of problems with it:
<p>
<UL>
<li> id's can start with _. Easy to fix.
<li> Escaped ' and " inside strings are not working. Easy to fix.
<li> Comments can only appear at statement level. A work-around is to add it to expressions and fields rules, which improves things a lot. Make sure to do *( comment ) instead of just comment to handle comments after each other.
<li> Long comments --[[ ]] are not supported. Easy to fix by changing comment to shortcomment and longcomment. Make sure to put longcomment first, because spirit is eager.
<li> a[b] = 2 does not parse. Some function calls are not parsed correctly, i.e. a(b)(). It seems that the refactoring of the left recursion with prefixexp is not done correctly. I have failed to fix this.
</UL>
<p>
The last point is a show-stopper for me. Thus I have failed to make Spirit parse Lua correctly.
<p>
-- Asger Ottar Alstrup (aalstrup at laerdal.dk)
<p>
There is another spirit parser that I wrote for SZARP SCADA system. It is tested mostly for simple
cases when we can bypass actual lua and execute statments without resorting to vm, but generally it seems
to be doing all right. It should not suffer from deficiencies mentioned above and is written using
latest spirit API. It may be a little difficult to use right away because it is a part of larger
system but still its dependencies are rather minimal. 
<p>
The parser files can be reached here:
<a href="http://szarp.git.sourceforge.net/git/gitweb.cgi?p=szarp/szarp;a=tree;f=libSzarp2;hb=master">http://szarp.git.sourceforge.net/git/gitweb.cgi?p=szarp/szarp;a=tree;f=libSzarp2;hb=master</a>
It is split among four files: include/lua_syntax.h and szbase/lua_parser.cc, szbase/lua_parser_extra.cc,
szbase/lua_parser_extra.h
<p>
In case of any questions, drop me an e-mail: Darek Marcinkiewicz (reksio at newterm.pl)
<p>
<p>
<H3>Lua 5.0 Lexer in re2c</H3>
<p>
<a href="../wiki/LexicalAnalysis.html" >LexicalAnalysis</a>
<p>
<H3>Lua 4.1 Grammar</H3>
<p>
Moved to <a href="../wiki/LuaFourOneGrammar.html" >LuaFourOneGrammar</a>
<p>
<H3>Lua 4 Interpreter in Java - JLua</H3>
<p>
An incomplete interpreter of Lua 4 implemented in Java: <a href="http://www.hetland.org/jlua/">http://www.hetland.org/jlua/</a> (broken link)
<p>
<H3>Lua 2.5 Interpreter in OCaml - Lua-ml</H3>
<p>
<a href="http://www.cminusminus.org/code.html#luaml">[Lua-ml]</a> is an implementation of Lua 2.5 in OCaml.  The parser is constructed with some OCaml parser generator, wrapped up in some literate programming system. 
<p>
<H3>Listing 1</H3>
<p>
Lua 5.1 grammar in Lemon--<a href="../wiki/RiciLake.html" >RiciLake</a>
<p>
<DL>
<dt><dd><pre>

%fallback  OPEN '(' .



chunk      ::= block .



semi       ::= ';' .

semi       ::= .



block      ::= scope statlist .

block      ::= scope statlist laststat semi .

ublock     ::= block 'until' exp .



scope      ::= .

scope      ::= scope statlist binding semi.

           

statlist   ::= .

statlist   ::= statlist stat semi .



stat       ::= 'do' block 'end' .

stat       ::= 'while' exp 'do' block 'end' .

stat       ::= repetition 'do' block 'end' .

stat       ::= 'repeat' ublock .

stat       ::= 'if' conds 'end' .

stat       ::= 'function' funcname funcbody .

stat       ::= setlist '=' explist1 .

stat       ::= functioncall .



repetition ::= 'for' NAME '=' explist23 .

repetition ::= 'for' namelist 'in' explist1 .

           

conds      ::= condlist .

conds      ::= condlist 'else' block .

condlist   ::= cond .

condlist   ::= condlist 'elseif' cond .

cond       ::= exp 'then' block .

           

laststat   ::= 'break' .

laststat   ::= 'return' .

laststat   ::= 'return' explist1 .



binding    ::= 'local' namelist .

binding    ::= 'local' namelist '=' explist1 .

binding    ::= 'local' 'function' NAME funcbody .



funcname   ::= dottedname .

funcname   ::= dottedname ':' NAME .



dottedname ::= NAME .

dottedname ::= dottedname '.' NAME .



namelist   ::= NAME .

namelist   ::= namelist ',' NAME .



explist1   ::= exp .

explist1   ::= explist1 ',' exp .

explist23  ::= exp ',' exp .

explist23  ::= exp ',' exp ',' exp .



%left      'or' .

%left      'and' .

%left      '&lt;' '&lt;=' '&gt;' '&gt;=' '==' '~=' .

%right     '..' .

%left      '+' '-' .

%left      '*' '/' '%' .

%right     'not' '#' .

%right     '^' .



exp        ::= 'nil'|'true'|'false'|NUMBER|STRING|'...' .

exp        ::= function .

exp        ::= prefixexp .

exp        ::= tableconstructor .

exp        ::= 'not'|'#'|'-' exp .         ['not']

exp        ::= exp 'or' exp .

exp        ::= exp 'and' exp .

exp        ::= exp '&lt;'|'&lt;='|'&gt;'|'&gt;='|'=='|'~=' exp .

exp        ::= exp '..' exp .

exp        ::= exp '+'|'-' exp .

exp        ::= exp '*'|'/'|'%' exp .

exp        ::= exp '^' exp .

           

setlist    ::= var .

setlist    ::= setlist ',' var .



var        ::= NAME .

var        ::= prefixexp '[' exp ']' .

var        ::= prefixexp '.' NAME .



prefixexp  ::= var .

prefixexp  ::= functioncall .

prefixexp  ::= OPEN exp ')' .



functioncall ::= prefixexp args .

functioncall ::= prefixexp ':' NAME args .



args        ::= '(' ')' .

args        ::= '(' explist1 ')' .

args        ::= tableconstructor .

args        ::= STRING .



function    ::= 'function' funcbody .



funcbody    ::= params block 'end' .



params      ::= '(' parlist ')' .



parlist     ::= .

parlist     ::= namelist .

parlist     ::= '...' .

parlist     ::= namelist ',' '...' .



tableconstructor ::= '{' '}' .

tableconstructor ::= '{' fieldlist '}' .

tableconstructor ::= '{' fieldlist ','|';' '}' .



fieldlist   ::= field .

fieldlist   ::= fieldlist ','|';' field .

            

field       ::= exp .

field       ::= NAME '=' exp .

field       ::= '[' exp ']' '=' exp .

</pre>
</DL>
<hr>
<a href="../wiki/RecentChanges.html" >RecentChanges</a> &middot; <a href="/cgi-bin/wiki.pl?action=editprefs" >preferences</a><br>
<a href="/cgi-bin/wiki.pl?action=edit&amp;id=LuaGrammar" >edit</a> &middot; <a href="/cgi-bin/wiki.pl?action=history&amp;id=LuaGrammar" >history</a><br>Last edited June 12, 2013 1:57 am GMT <a href="/cgi-bin/wiki.pl?action=browse&amp;diff=1&amp;id=LuaGrammar" >(diff)</a>
</body>
</html>