<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML><HEAD><TITLE>lua-users wiki: John Belmonte</TITLE>
<LINK TYPE="text/css" REL="stylesheet" HREF="../styles/main.css">
</HEAD>
<BODY ><table width="100%" border="0"> <tr><td align=left width="100%"><h1><a href="/cgi-bin/wiki.pl?action=search&amp;string=JohnBelmonte&amp;body=1" title="List pages referring to JohnBelmonte">John Belmonte</a></h1></td><td align=right>
    <table cellpadding="0" cellspacing="0" border="0" width="1%">
      <tbody>
        <tr>
            <td><a href="../index.html">
            <img src="../images/nav-logo.png" alt="lua-users home" width="177" height="40" border="0"></a></td>
        </tr>
        <tr>
            <td>
            <table cellpadding="0" cellspacing="0" border="0" width="100%">
                <tbody>
                <tr>
                    <td><img src="../images/nav-elbow.png" alt="" width="48" height="40"></td>
                    <td nowrap valign="middle" width="100%">
                        <a href="../wiki/index.html" class="nav">wiki</a></td>
                </tr>
                </tbody>
            </table>
            </td>
        </tr>
      </tbody>
    </table>
<form method="post" action="../wiki/FindPage.html" enctype="application/x-www-form-urlencoded" style="display:inline; margin:0;">
<input type="hidden" name="action" value="search"  /><input type="text" name="string"  size="20" style="" id="search_query1" /><input type="hidden" name="title" value="1"  /><input type="submit" name=".submit" value="Search" /><input type="hidden" name="body" value="on"  /></form></td></tr> </table>
<br clear=all>
<a href="mailto:john@neggie.net">mailto:john@neggie.net</a>
<p>
Lua-user, man behind the wiki curtain.  (Challenge:  say "lua-users" ten times fast.)
<p>
<strong>I've influenced Lua by successful lobbying for:</strong>
<UL>
<li> <a href="http://lua-users.org/lists/lua-l/2000-04/msg00079.html">[employing a table as the global scope]</a> (Lua 5.0)
<li> lexical scoping (Lua 5.0)
<li> boolean type (Lua 5.0)
<li> use of standard license (Lua 5.0)
<li> incremental garbage collection (Lua 5.1)
<li> honoring <code>__tostring</code> on display of error objects (Lua 5.2)
</UL>
<p>
<strong>I wrote a chapter in <a href="http://www.lua.org/gems/">[Lua Programming Gems]</a> on exceptions.  I presented <a href="http://www.lua.org/wshop06.html#Belmonte">[Exception patterns in Lua]</a> at the second Lua workshop, in 2006.</strong>
<p>
<strong>My Pages</strong> (or at least pages I started)
<UL>
<li> <a href="../wiki/LuaScoping.html" >LuaScoping</a>, <a href="../wiki/LuaInRealTimePrograms.html" >LuaInRealTimePrograms</a>, <a href="../wiki/LuaPowerPatches.html" >LuaPowerPatches</a>, <a href="../wiki/BooleanTypeProposal.html" >BooleanTypeProposal</a>, <a href="../wiki/LuaLicense.html" >LuaLicense</a>, <a href="../wiki/CountingFromOne.html" >CountingFromOne</a>, <a href="../wiki/LuaFunctors.html" >LuaFunctors</a>
</UL>
<p>
<strong>My posts to lua-l</strong> <a href="http://lua-users.org/cgi-bin/namazu.cgi?query=%2Bauthor%3A%22John+Belmonte%22&amp;idxname=lua-l&amp;max=20&amp;result=normal&amp;sort=date%3Alate">[1]</a>
<p>
<strong>Favorite lua-users wiki pages</strong>
<UL>
<li> <a href="../wiki/FiltersAndPipesReloaded.html" >FiltersAndPipesReloaded</a>
<li> <a href="../wiki/TextTemplate.html" >TextTemplate</a>
</UL>
<p>
<strong>lua-users.org is...</strong>
<UL>
<li> (un)popular <a href="http://lua-users.org/stats/">[2]</a>
</UL>
<p>
<strong>I think Python PEP's <a href="http://www.python.org/peps/">[3]</a> are a great source of info.</strong>  Find out where Python was flawed and how it's being fixed.  Learn about Python's implementations of the latest language fads.
<p>
<strong>I'd like to mention a wonderful property of (most) wiki implementations that may not be entirely obvious.</strong>  They forget the past.  Although an edit history is maintained for each page, it fades out over time.  So deleted mistakes, unkind words, and useless material really disappear unless someone explicitly acts to revive or archive them.  This is quite a different concept from the mailing list or newsgroup where, in the case of a public forum, every word may likely be archived until the end of civilization.  An interesting article related to this subject is <em>In Defense of the <code>DELETE</code> Key</em> <a href="http://simson.net/ref/2005/csci_e-170/ref/rosenbaum_deletekey.pdf">[4]</a>.
<p>
<strong>Here's how to use the unix <code>wget</code> command to make a static copy of this wiki for offline browsing.</strong>  Of course you can't edit or search the wiki when offline, so that takes the fun out of things.
<DL>
<dt><dd><pre>wget --mirror --html-extension --convert-links http://lua-users.org/wiki/</pre>
</DL>
<p>
<H3>PROJECT IDEAS</H3>
These are in order from impossible to really-impossible.  I hope someone does this stuff so I don't have to.
<UL>
<li> <strong>Lua-based build system</strong> - something like Jam <a href="http://www.perforce.com/jam/jam.html">[5]</a> could be done ten times better using Lua.  It would also allow programs using Lua to easily share info with the build system... a big win for managing complex program data.  <em>(See <a href="../wiki/LuaBuildSystems.html" >LuaBuildSystems</a>)</em>
<li> <strong>alternate implementation of Lua in D</strong> - (someone has finally attempted, see <a href="https://github.com/codekitchen/Lua-D">[Lua-D]</a>)
</UL>
<p>
<H3>JOHN'S LUA WARTS</H3>
These points are serious and if not fixed eventually (I'm fairly patient) I'd consider starting a Lua derivative that implements them:
<p>
<UL>
<li> <strong>No scope hook metamechanism.</strong>  Many applications expose scarce resources to the scripting environment such as locks; handles for files, memory, and database transactions; etc.  Such resources need to be released promptly and deterministically after use, and despite any exceptional condition in the program.  Of course this can be accomplished with Lua as it is, but the resulting code is hard to follow, highly error prone, and makes heavy use of protected calls-- limiting potential use of coroutines.  This could be resolved if Lua provided a way to hook into scope exit events.  See <a href="http://john.neggie.net/2009/lua/resource_finalization">[Lua: Improving deterministic resource cleanup]</a>.
</UL>
<p>
<UL>
<li> <strong>Table constructors drop sequence length information.</strong> When a table is defined by a table constructor (e.g. { x = 10; 'foo', 5, bar() }, the length of the list part-- known by the core when it constructs the table-- is discarded.  The length operator (#) can correctly deduce it afterwards, but only if there were no nil values in the sequence.  (As somewhat clunky solution, <code>table.pack</code> in Lua 5.2 will cover sequence-only tables.)
</UL>
<p>
<UL>
<li> <strong>No efficient and concise list iteration.</strong>  The "<code>for i=1,getn(t)</code>" idiom is verbose and when used carelessly requires a global table lookup per item.  The <code>foreachi</code> idiom is not efficient due to extra function call overhead per item, and not concise due to the need to define a function object.  I have implemented a new <code>for</code> construct as a solution, see <a href="../wiki/LuaPowerPatches.html" >LuaPowerPatches</a>.  (As of Lua 5.1, the idoms have changed but the issue still stands.  We now have "<code>for i=1,#t</code>" or "<code>for _,item in ipairs(t)</code>".)
</UL>
<p>
These points are ugly but tolerable:
<p>
<UL>
<li> <strong>Indexing from 1 and use of closed ranges.</strong>  Indexing from 1 is contrary to the most-used languages and argued against succinctly by Dijkstra <a href="http://www.cs.utexas.edu/users/EWD/transcriptions/EWD08xx/EWD831.html">[6]</a>.  In Lua, closed ranges are used in the "for" construct and library functions, with the uncomfortable (n, n-1) meaning zero length.  Index adjustments of +/-1 are often required in normal code.  (See <a href="../wiki/CountingFromOne.html" >CountingFromOne</a>.)
</UL>
<p>
<UL>
<li> <strong>List operations do not support nil elements.</strong> The # operator and functions which depend on it such as unpack and ipairs are non-deterministic should a list contain a nil element, or else simply ignore trailing nils.  Nil is a useful value, and reasonable behavior of this fundamental data type should not be obstructed by Lua's table implementation of it.  (Roberto has admitted that nil is not a first class value because of this issue.)  This limitation would be fairly straightforward to work around if table constructors did not drop sequence length information (see above).
</UL>
<p>
<UL>
<li> <strong>Lua core and standard libraries do not enumerate exceptions.</strong>  The set of errors which can be raised by the Lua core and standard libraries are not enumerated.  If an application wants to catch a specific error, it must employ the fragile practice of parsing exception strings.
</UL>
<p>
<UL>
<UL>
<li> BTW, more generally perhaps "traceback reform" on my page.  For example, Lua concatenates file paths with string exceptions and even truncates those file paths.  --<a href="../wiki/DavidManura.html" >DavidManura</a>
</UL>
</UL>
<p>
Historical warts which have been resolved:
<p>
<UL>
<li> <strong>Global scope is treated specially.</strong>  Although the global scope can be treated as a normal table in many respects, user-defined events are handled differently.  (Fixed in Lua 5.0.)  For example the following lines call different assignment events: 
</UL>
<pre>

        a = 5

        globals().a = 5

</pre>
<UL>
<li> <strong>No lexical scoping.</strong>  The upvalue feature used with tables provides a form of lexical scoping, but only for the case of accessing the next higher scope.  (Fixed in Lua 5.0.)
</UL>
<p>
<UL>
<li> <strong>No user-defined iteration.</strong>  The lack of hooks for user-defined iteration prevents us from making useful proxy tables and lists.  (Fixed in Lua 5.0.)
</UL>
<p>
<UL>
<li> <strong>Value nil used for false.</strong>  It's not possible to distinguish between a non-existant variable and a variable assigned from a boolean expression.  (See <a href="../wiki/BooleanTypeProposal.html" >BooleanTypeProposal</a>.  Fixed in Lua 5.0.)
</UL>
<p>
<UL>
<li> <strong>Poor type control in implementation.</strong> Implementation does not provide compile options for (complete) control of C type useage. For example double and long types are referenced extensively causing problems for certain platforms.  (Much improved starting with Lua 5.0.)
</UL>
<p>
<UL>
<li> <strong>Cannot override length operator (#) on tables or strings.</strong>  Most notably in the case of tables, this obstructs the creation of custom list-like objects from Lua code.  (Fixed-- at least for tables-- in Lua 5.2.)
</UL>
<p>
<UL>
<li> <strong><code>lua_tostring</code> does not honor <code>__tostring</code> metatable hook.</strong>  <code>lua_tostring</code> in the C API and <code>tostring</code> in the base Lua library are not equivalent.  The former does not honor the <code>__tostring</code> hook, which is important for debug and error output of user defined types, and in general the emulation of strings with user types.  As an example of the problem, the <code>lua</code> command line interpreter uses <code>lua_tostring</code> in the case of uncaught exceptions, leaving no way to communicate the details of non-string exception objects to the user.  (In Lua 5.2 there is a separate function <code>luaL_tolstring</code> which honors <code>__tostring</code>, and interpreter exception handler appears to use this.)
</UL>
<p>
<UL>
<li> <strong><code>string.format</code> %s does not invoke <code>tostring</code>.</strong> (Fixed in Lua 5.2.)
</UL>
<hr>
<a href="../wiki/RecentChanges.html" >RecentChanges</a> &middot; <a href="/cgi-bin/wiki.pl?action=editprefs" >preferences</a><br>
<a href="/cgi-bin/wiki.pl?action=edit&amp;id=JohnBelmonte" >edit</a> &middot; <a href="/cgi-bin/wiki.pl?action=history&amp;id=JohnBelmonte" >history</a><br>Last edited February 26, 2014 10:49 am GMT <a href="/cgi-bin/wiki.pl?action=browse&amp;diff=1&amp;id=JohnBelmonte" >(diff)</a>
</body>
</html>