<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML><HEAD><TITLE>lua-users wiki: Lua Five Two</TITLE>
<LINK TYPE="text/css" REL="stylesheet" HREF="../styles/main.css">
</HEAD>
<BODY ><table width="100%" border="0"> <tr><td align=left width="100%"><h1><a href="/cgi-bin/wiki.pl?action=search&amp;string=LuaFiveTwo&amp;body=1" title="List pages referring to LuaFiveTwo">Lua Five Two</a></h1></td><td align=right>
    <table cellpadding="0" cellspacing="0" border="0" width="1%">
      <tbody>
        <tr>
            <td><a href="../index.html">
            <img src="../images/nav-logo.png" alt="lua-users home" width="177" height="40" border="0"></a></td>
        </tr>
        <tr>
            <td>
            <table cellpadding="0" cellspacing="0" border="0" width="100%">
                <tbody>
                <tr>
                    <td><img src="../images/nav-elbow.png" alt="" width="48" height="40"></td>
                    <td nowrap valign="middle" width="100%">
                        <a href="../wiki/index.html" class="nav">wiki</a></td>
                </tr>
                </tbody>
            </table>
            </td>
        </tr>
      </tbody>
    </table>
<form method="post" action="../wiki/FindPage.html" enctype="application/x-www-form-urlencoded" style="display:inline; margin:0;">
<input type="hidden" name="action" value="search"  /><input type="text" name="string"  size="20" style="" id="search_query1" /><input type="hidden" name="title" value="1"  /><input type="submit" name=".submit" value="Search" /><input type="hidden" name="body" value="on"  /></form></td></tr> </table>
<br clear=all>
Lua 5.2 is the latest major revision<a href="http://www.lua.org/versions.html">[1]</a> of Lua following 5.1.  This page has some information the mailing list during alpha/beta testing that may be out-of-date or incorrect.  Official information and downloads on Lua 5.2 are at [www.lua.org/manual/5.2].
<p>
<H2>Scope</H2>
<p>
While 5.1.x versions are strictly bug-fix only versions of 5.1<a href="/lists/lua-l/2007-05/msg00554.html">[12]</a><a href="/lists/lua-l/2007-12/msg00393.html">[13]</a><a href="http://www.lua.org/bugs.html">[2]</a>, Lua 5.2 was allowed to make design changes that break full compatibility.
<p>
<H2>History</H2>
<UL>
<li> 2011-12-16, Lua <a href="/lists/lua-l/2011-12/msg00482.html">[5.2.0-final]</a> <a href="/lists/lua-l/2011-12/msg00352.html">[rc8]</a> <a href="/lists/lua-l/2011-12/msg00277.html">[rc7]</a> <a href="/lists/lua-l/2011-12/msg00247.html">[rc6]</a> <a href="/lists/lua-l/2011-12/msg00122.html">[rc5]</a> <a href="/lists/lua-l/2011-11/msg01157.html">[rc4]</a> <a href="/lists/lua-l/2011-11/msg01116.html">[rc3]</a> <a href="/lists/lua-l/2011-11/msg00932.html">[rc2]</a> <a href="/lists/lua-l/2011-11/msg00885.html">[rc1]</a>
<li> 2011-07-13, Lua <a href="/lists/lua-l/2011-07/msg00376.html">[5.2.0-beta]</a> <a href="/lists/lua-l/2011-07/msg00219.html">[rc7]</a> <a href="/lists/lua-l/2011-07/msg00127.html">[rc6]</a> <a href="/lists/lua-l/2011-07/msg00083.html">[rc5]</a> <a href="/lists/lua-l/2011-06/msg01338.html">[rc4]</a> <a href="/lists/lua-l/2011-06/msg01272.html">[rc3]</a> <a href="/lists/lua-l/2011-06/msg00943.html">[rc2]</a> <a href="/lists/lua-l/2011-06/msg00515.html">[rc1]</a> ; <a href="http://www.corsix.org/lua/5.2-beta-annotated/manual.html">[Corsix: Annotated 5.2 Reference Manual]</a><a href="/lists/lua-l/2011-06/msg01143.html">[14]</a>
<li> 2010-11-16, Lua <a href="/lists/lua-l/2010-11/msg00312.html">[5.2.0-alpha]</a> <a href="/lists/lua-l/2010-11/msg00705.html">[rc4]</a> <a href="/lists/lua-l/2010-11/msg00654.html">[rc3]</a> <a href="/lists/lua-l/2010-11/msg00379.html">[rc2]</a>
<li> 2010-07-31, Lua 5.2.0-work4 <a href="/lists/lua-l/2010-07/msg00862.html">[15]</a>
<li> 2010-05-18, Lua 5.2.0-work3 <a href="/lists/lua-l/2010-05/msg00331.html">[16]</a> (work release) posted. <a href="/lists/lua-l/2010-05/msg00470.html">[review of source changes]</a> (Peter Cawley)
<li> 2010-01-13, Lua 5.2.0-work2 <a href="/lists/lua-l/2010-01/msg00814.html">[17]</a>
<li> 2010-01-08, Lua 5.2.0-work1 <a href="/lists/lua-l/2010-01/msg00260.html">[18]</a><a href="/lists/lua-l/2010-01/msg00536.html">[changes]</a>
<li> Feb 2008, there is no complete list of changes nor a scheduled release date.<a href="http://www.lua.org/faq.html#1.3">[3]</a> 
</UL>
<p>
<H2>Background Information</H2>
<p>
<UL>
<li> <a href="http://www.inf.puc-rio.br/~roberto/talks/novelties-5.2.pdf">[The Novelties of Lua 5.2]</a> - Slides by Roberto, September 2011.
</UL>
<p>
<H2>Note</H2>
<p>
<em>Feel free to update references! (As well as anything else here.) -- <a href="../wiki/AlexanderGladysh.html" >AlexanderGladysh</a></em>
<p>
TODO: Some sections below may need updated to reflect the final Lua 5.2.0 version.
<p>
<H3>Emergency garbage collector</H3>
<p>
Lua core forces a GC when allocation fails.
<p>
<em>References:</em>
<p>
<UL>
<li> <a href="../wiki/EmergencyGarbageCollector.html" >EmergencyGarbageCollector</a>
<li> "The Novelties of Lua 5.2" above
</UL>
<p>
<H3>Generational garbage collector (optional and experimental)</H3>
<p>
<UL>
<li> <a href="http://www.lua.org/manual/5.2/manual.html#2.5">[manual: Garbage Collection]</a> - "As an experimental feature in Lua 5.2, you can change the collector's operation mode from incremental to generational. A generational collector assumes that most objects die young, and therefore it traverses only young (recently created) objects. This behavior can reduce the time used by the collector, but also increases memory usage (as old dead objects may accumulate). To mitigate this second problem, from time to time the generational collector performs a full collection. Remember that this is an experimental feature; you are welcome to try it, but check your gains."
<li> <a href="http://www.lua.org/manual/5.2/manual.html#pdf-collectgarbage">[manual: collectgarbage]</a> <code>"generational"</code>
<li> <a href="http://www.lua.org/manual/5.2/manual.html#lua_gc">[manual: lua_gc]</a> <code>LUA_GCGEN</code>
<li> "The Novelties of Lua 5.2" above
</UL>
<p>
<H3>Ephemeron tables</H3>
<p>
Tables with weak keys only visit value when key is accessible.
<p>
<em>References:</em> 
<UL>
<li> <a href="../wiki/GarbageCollectingWeakTables.html" >GarbageCollectingWeakTables</a>
<li> <a href="http://www.lua.org/wshop08.html#barros">[WS08 - Eliminating Cycles in Weak Tables]</a>
<li> <a href="http://vimeo.com/1705146">[4]</a>
<li> <a href="http://en.wikipedia.org/wiki/Ephemeron.html">[Wikipedia:Ephemeron]</a>
<li> <a href="http://portal.acm.org/citation.cfm?id=263733">[Ephemerons: a new finalization mechanism]</a>
<li> "The Novelties of Lua 5.2" above
</UL>
<p>
<H3>Userdata with finalizers</H3>
<p>
Userdata with finalizers are kept in a separated list for the GC
<p>
<em>References:</em>
<p>
<UL>
<li> <a href="/lists/lua-l/2008-02/msg00720.html">LuaList:2008-02/msg00720.html</a> - announce
</UL>
<p>
<H3>Non-string error messages</H3>
<p>
Lua interpreter better handles non-string error messages.
<p>
<em>References:</em>
<UL>
<li> <a href="../wiki/LuaPowerPatches.html" >LuaPowerPatches</a> "Custom error object support" - patch for 5.1
<li> <a href="/lists/lua-l/2010-01/msg00505.html">LuaList:2010-01/msg00505.html</a> - announced
</UL>
<p>
<H3>xpcall() improved</H3>
<p>
xpcall() now accepts arguments for the callback just like pcall() does
<p>
<em>References:</em>
<UL>
<li> <a href="/lists/lua-l/2004-08/msg00265.html">LuaList:2004-08/msg00265.html</a> - proposal
<li> <a href="/lists/lua-l/2006-02/msg00536.html">LuaList:2006-02/msg00536.html</a> - proposal
<li> <a href="/lists/lua-l/2006-08/msg00031.html">LuaList:2006-08/msg00031.html</a> - proposal
<li> <a href="/lists/lua-l/2007-11/msg00592.html">LuaList:2007-11/msg00592.html</a> - planned
<li> <a href="/lists/lua-l/2010-01/msg00536.html">LuaList:2010-01/msg00536.html</a> - announced
</UL>
<p>
<H3>package.searchpath()</H3>
<p>
New function package.searchpath() to search for your files just like require() does.
<p>
<em>References:</em>
<UL>
<li> <a href="/lists/lua-l/2008-02/msg00686.html">LuaList:2008-02/msg00686.html</a> - planned
<li> <a href="/lists/lua-l/2010-01/msg00536.html">LuaList:2010-01/msg00536.html</a> - announced
</UL>
<p>
<H3>package.config</H3>
<p>
Compile-time module system settings, available in package.config, are now documented.
<p>
<em>References:</em>
<p>
<UL>
<li> <a href="/lists/lua-l/2006-07/msg00089.html">LuaList:2006-07/msg00089.html</a> - observed in 5.1
<li> <a href="/lists/lua-l/2010-01/msg00481.html">LuaList:2010-01/msg00481.html</a> - question why not a table
<li> <a href="/lists/lua-l/2010-06/msg00193.html">LuaList:2010-06/msg00193.html</a> - question why not a table
<li> <a href="http://www.lua.org/work/doc/manual.html#pdf-package.config">[package.config]</a> - reference manual draft
</UL>
<p>
<H3>__pairs and __ipairs</H3>
<p>
Loop iteration can be overloaded now with the help of new __pairs and __ipairs metamethods.
<p>
<em>References:</em> <a href="../wiki/GeneralizedPairsAndIpairs.html" >GeneralizedPairsAndIpairs</a>
<p>
<H3>__len</H3>
<p>
All types except string now respect __len metamethod. Previously, __len was not respected for table.
<p>
<em>References:</em>
<UL>
<li> <a href="http://www.lua.org/manual/5.2/manual.html#2.4">[Manual, 2.4 Â– Metatables and Metamethods]</a>
<li> <a href="../wiki/LuaVirtualization.html" >LuaVirtualization</a> - proposal
<li> <a href="../wiki/GeneralizedPairsAndIpairs.html" >GeneralizedPairsAndIpairs</a> - proposal
<li> <a href="/lists/lua-l/2006-01/msg00158.html">LuaList:2006-01/msg00158.html</a> - proposal
</UL>
<p>
<H3>%q improved</H3>
<p>
string.format("%q") now escapes control characters.
<p>
<em>References:</em>
<p>
<UL>
<li> <a href="/lists/lua-l/2007-07/msg00364.html">LuaList:2007-07/msg00364.html</a> - planned
</UL>
<p>
<H3>Goto statement (includes simulating continue and labeled break statements)</H3>
<p>
References:
<p>
<UL>
<li> <a href="../wiki/GotoStatement.html" >GotoStatement</a>
<li> <a href="../wiki/ContinueProposal.html" >ContinueProposal</a> - proposal
<li> <a href="/lists/lua-l/2010-01/msg00816.html">LuaList:2010-01/msg00816.html</a> - proposal
</UL>
<p>
<H3>Hexadecimal notation in string literals</H3>
<p>
You can write \xFF in strings in addition to old \255 notation.
<p>
<em>References:</em>
<p>
<UL>
<li> <a href="/lists/lua-l/2009-06/msg00219.html">LuaList:2009-06/msg00219.html</a> - planned
</UL>
<p>
<H3>Hexadecimal fractions and exponents in numerical literals</H3>
<p>
You can write numerical constants of the form 0x0.A or 0xA23p-4. In the latter case
the 'p' indicates a binary exponent expressed in decimal (the manual does not make this
clear: I assumed the exponent would be hexadecimal like the other parts). This feature
is probably not useful in hand-written code but it allows precise de-serialisation of
numbers serialised using the hexadecimal option of string.format.
<p>
However despite the inclusion of an official bit manipulation library, binary literals
are still not supported.
<p>
<em>References:</em>
<p>
<UL>
<li> <a href="http://www.lua.org/manual/5.2/manual.html#3.1">[Manual, 3.1 Â– Lexical Conventions]</a>
<li> <a href="/lists/lua-l/2011-12/msg00035.html">LuaList:2011-12/msg00035.html</a> - 5.1 patch for hex floats
<li> <a href="/lists/lua-l/2011-12/msg00036.html">LuaList:2011-12/msg00036.html</a> - <a href="../wiki/LuaJit.html" >LuaJit</a> 2 patch for hex floats
<li> <a href="/lists/lua-l/2011-12/msg00025.html">LuaList:2011-12/msg00025.html</a>
<li> <a href="/lists/lua-l/2011-08/msg00173.html">LuaList:2011-08/msg00173.html</a>
<li> <a href="/lists/lua-l/2010-12/msg00150.html">LuaList:2010-12/msg00150.html</a>
<li> <a href="/lists/lua-l/2007-01/msg00530.html">LuaList:2007-01/msg00530.html</a> - msvc strtod2
<li> <a href="/lists/lua-l/2009-02/msg00089.html">LuaList:2009-02/msg00089.html</a> - lack of <code>%b</code> in <code>string.format</code> / <code>sprintf</code>
<li> <a href="/lists/lua-l/1997-07/msg00019.html">LuaList:1997-07/msg00019.html</a> - binary literals
<li> Hex and binary literals map 1-1 in four-bit chunks.  0xF01 -&gt; 1111 0000 0001 b.  Therefore, hex notation is usually sufficiently convenient for representing binary data.  Also, hex can be more readable in being less prone to mistakes in counting the number of 1' and 0's in a long bit string: 111100000001.
<li> But an alternative view is that both Hex and Binary should be supported. Binary is better for working with hardware registers where bitfields are not necessarily aligned in four-bit chunks and do not necessarily represent numbers at all. Many uses of the new bit32 library will be clearer with binary literals rather than hexadecimal.
<li> <a href="../wiki/LuaPowerPatches.html" >LuaPowerPatches</a> - Patch to add binary literals in Java/Python style with embedded underscores for readability.
</UL>
<p>
<H3>Safer os.date()</H3>
<p>
os.date() now allows ANSI C options only.
<p>
<em>References:</em>
<p>
<UL>
<li> <a href="/lists/lua-l/2007-04/msg00511.html">LuaList:2007-04/msg00511.html</a> - proposal
</UL>
<p>
<H3>luaL_testudata()</H3>
<p>
New luaL_testudata API function, similar to luaL_checkudata, but signaling invalid userdata to the caller rather than throwing an error.
<p>
<em>References:</em>
<p>
<UL>
<li> <a href="/lists/lua-l/2009-06/msg00516.html">LuaList:2009-06/msg00516.html</a> - proposal
<li> <a href="/lists/lua-l/2009-06/msg00551.html">LuaList:2009-06/msg00551.html</a> - planned
</UL>
<p>
<H3>Constant folding simplified</H3>
<p>
Division and modulo operations are no longer folded if the second argument is zero..
<p>
<em>References:</em>
<p>
<UL>
<li> <a href="/lists/lua-l/2007-02/msg00212.html">LuaList:2007-02/msg00212.html</a> - planned
</UL>
<p>
<H3>More freedom to yield()</H3>
<p>
Now you may yield() accross metamethods, for loop iterators pcall and xpcall calls and now-undocumented table.foreach[i] calls.
<p>
Also, C API calls are provided to implement your own yield-compliant C functions.
<p>
<UL>
<li> Based on <a href="../wiki/ResumableVmPatch.html" >ResumableVmPatch</a> <a href="/lists/lua-l/2009-08/msg00540.html">[19]</a>.
<li> "The Novelties of Lua 5.2" above
</UL>
<p>
<H3>Bitwise operations module</H3>
<p>
Now you can manipulate bits in Lua without the help of 3rd party modules or patches. None of existing implementations was used though.
<p>
<em>References:</em>
<UL>
<li> <a href="../wiki/BitwiseOperators.html" >BitwiseOperators</a> - proposals
<li> <a href="/lists/lua-l/2008-02/msg00720.html">LuaList:2008-02/msg00720.html</a> - announcement for some bitlib
<li> <a href="/lists/lua-l/2008-02/msg00741.html">LuaList:2008-02/msg00741.html</a> - bit library not bit syntax operators
<li> <a href="/lists/lua-l/2009-06/msg00264.html">LuaList:2009-06/msg00264.html</a> - confirmation
<li> <a href="/lists/lua-l/2010-01/msg00290.html">LuaList:2010-01/msg00290.html</a> - controversy (Lua Bit<code></code>Op)
</UL>
<p>
<H3>luaL_tolstring()</H3>
<p>
Now luaL_tolstring is documented. You may officially convert Lua values from C by the tostring() rules.
<p>
<em>References:</em> <a href="/lists/lua-l/2008-02/msg00768.html">[20]</a>
<p>
<H3>New functions: lua_tonumberx and luatointegerx</H3>
<p>
<em>References:</em>
<p>
<UL>
<li> <a href="/lists/lua-l/2010-07/msg00862.html">LuaList:2010-07/msg00862.html</a> - announce 5.2.0work4
</UL>
<p>
<H3>Lexical environments</H3>
<p>
_ENV
<p>
<em>References:</em>
<p>
<UL>
<li> <a href="/lists/lua-l/2010-02/msg00753.html">LuaList:2010-02/msg00753.html</a> - planned
<li> <a href="/lists/lua-l/2010-06/msg00317.html">LuaList:2010-06/msg00317.html</a> - comments
<li> "The Novelties of Lua 5.2" above
</UL>
<p>
<H3>getfenv() / setfenv() deprecated</H3>
<p>
getfenv() and setfenv() are deprecated in favor of the new lexical environments. Debug library counterparts are still there.
<p>
<em>References:</em>
<p>
<UL>
<li> <a href="/lists/lua-l/2010-02/msg00753.html">LuaList:2010-02/msg00753.html</a> - planned
</UL>
<p>
<H3>function/closure construction optimization</H3>
<p>
Cache anonymous functions/closures for reuse.  This optimization is now possible with the removal of getfenv/setfenv.  TODO:add better description and examples.
<p>
<UL>
<li> <a href="/lists/lua-l/2010-05/msg00617.html">LuaList:2010-05/msg00617.html</a> - proposal / patch
<li> <a href="/lists/lua-l/2010-07/msg00375.html">LuaList:2010-07/msg00375.html</a> - planned
<li> <a href="/lists/lua-l/2010-07/msg00862.html">LuaList:2010-07/msg00862.html</a> - announce in 5.2.0work4
</UL>
<p>
<H3>loadin()</H3>
<p>
New loadin(env,chunk) function to load chunk in a given environment. Note that the <code>chunk</code> argument can also be a string.
<p>
<pre class="code">
fn,err = loadin({x=1,y=2},<span class="string">"return x+y"</span>)

</pre>

<p>
<em>References:</em> 
<p>
<UL>
<li> <a href="/lists/lua-l/2010-08/msg00236.html">LuaList:2010-08/msg00236.html</a> - concise description
</UL>
<p>
<H3>load() chunk type filter</H3>
<p>
It is possible to forbid load()-ing of bytecode and/or source code chunks. Bytecode verification on load was removed.
<p>
<em>References:</em>
<p>
<UL>
<li> <a href="/lists/lua-l/2009-03/msg00039.html">LuaList:2009-03/msg00039.html</a> - planned
</UL>
<p>
<H3>Lua thread environment</H3>
<p>
Lua threads (a.k.a coroutines) no longer have separate environments.
<p>
<em>References:</em> (Anyone?)
<p>
<H3>ABI and bytecode incompatibility</H3>
<p>
As expected Lua 5.2 ABI and bytecode is incompatible with 5.1.
<p>
<em>References:</em>
<UL>
<li> <a href="/lists/lua-l/2010-02/msg00753.html">LuaList:2010-02/msg00753.html</a> - "There are no more GETGLOBAL/SETGLOBAL opcodes." - Roberto Ierusalimschy
</UL>
<p>
<H3>Deprecated features from 5.1</H3>
<p>
Almost all deprecated features from 5.1 were removed. New deprecated features are off by default.
<p>
<em>References:</em> (Anyone?)
<p>
<H3>Debug module no longer loaded by default</H3>
<p>
If you need it, require() it.
<p>
<DL>
<dt><dd>Assuming this refers to the debug library, it does not seem to be the case in the release version - the debug library is in the list loaded by <code>luaL_openlibs</code>. --<a href="../wiki/JohnHind.html" >JohnHind</a>
</DL>
<p>
<em>References:</em>
<UL>
<li> Source file <code>linit.c</code>
</UL>
<p>
<H3>Coroutine library promoted to a fully-fledged library</H3>
<p>
Previously the coroutine library was a sub-library loaded by the basic library loader function. In 5.2 it has been given its own loader function and promoted to a normal library. It is included in the list loaded by <code>luaL_openlibs</code> so this change is only important if your runtime does not use <code>luaL_openlibs</code>.
<p>
The manual has a slight error: this change is reflected in section 6, but section 6.2 still refers to it as "a sub-library of the basic library".
<p>
<em>References:</em>
<UL>
<li> <a href="http://www.lua.org/manual/5.2/manual.html#6.2">[5]</a> - Lua 5.2 Reference Manual
<li> Source files <code>linit.c, lcorolib.c</code>
</UL>
<p>
<H3>debug.getlocal parameter names</H3>
<p>
debug.getlocal gets parameter names of inactive functions.  In <code>debug.getlocal ([thread,] f, local)</code>, "The parameter f may also be a function. In that case, getlocal returns only the name of function parameters."
<p>
<em>References:</em>
<p>
<UL>
<li> <a href="/lists/lua-l/2010-07/msg00862.html">LuaList:2010-07/msg00862.html</a> - announce in 5.2.0work4
</UL>
<p>
<H3>Upvalue manipulation</H3>
<p>
New functions to detect if two upvalues are the same and to join them together if they are not:
<p>
<UL>
<li> debug.upvalueid()
<li> debug.upvaluejoin()
<li> lua_upvalueid()
<li> lua_upvaluejoin()
</UL>
<p>
<em>References:</em>
<p>
<UL>
<li> <a href="/lists/lua-l/2008-02/msg01173.html">LuaList:2008-02/msg01173.html</a> - proposal
<li> <a href="/lists/lua-l/2010-01/msg00536.html">LuaList:2010-01/msg00536.html</a> - announce
</UL>
<p>
<H3>Additional debug info</H3>
<p>
debug.getinfo() and lua_getinfo() now return extra information about function on call stack:
<p>
<UL>
<li> Was it called via tail call?
<li> Number of upvalues.
<li> Number of arguments.
<li> Is this a vararg function?
</UL>
<p>
<em>References:</em> (Anyone?)
<p>
<H3>Pattern: %f is documented</H3>
<p>
The frontier pattern is now documented.
<p>
<em>References:</em>
<p>
<UL>
<li> <a href="../wiki/FrontierPattern.html" >FrontierPattern</a>
<li> <a href="/lists/lua-l/2004-09/msg00294.html">LuaList:2004-09/msg00294.html</a> - comments, roberto
<li> <a href="/lists/lua-l/2009-12/msg00891.html">LuaList:2009-12/msg00891.html</a> - comments
<li> <a href="/lists/lua-l/2009-12/msg00978.html">LuaList:2009-12/msg00978.html</a> - comments
</UL>
<p>
<H3>Pattern: %g</H3>
<p>
New pattern <code>%g</code> represents all printable characters except space.
<p>
<UL>
<li> <a href="/lists/lua-l/2010-07/msg00862.html">LuaList:2010-07/msg00862.html</a> - announce in 5.2.0work4
</UL>
<p>
<H3>string.gsub repl</H3>
<p>
<DL>
<dt><dd><code>string.gsub</code> <a href="http://www.lua.org/manual/5.2/manual.html#pdf-string.gsub">[6]</a> now raises an error if the replacement string contains a '%' followed by a character other than the permitted '%' or digit.
</DL>
<p>
<UL>
<li> <a href="/lists/lua-l/2010-02/msg00708.html">LuaList:2010-02/msg00708.html</a>
</UL>
<p>
<H3>ipairs behaviour change (this feature has been retracted)</H3>
<p>
Now ipairs() iterates over #t elements of the table. In 5.1 it did until first nil.
<p>
<UL>
<li> In 5.2-work4 it again is going until the first nil.
</UL>
<p>
<em>References:</em> Source code: lua-5.2.0-work4/src/lbaselib.c line 213
<p>
<H3>select() negative numbers</H3>
<p>
You may pass negative index to select() to get arguments from the end of the vararg (in the direct order).
<p>
<em>References:</em>
<p>
<UL>
<li> <a href="/lists/lua-l/2010-03/msg00223.html">LuaList:2010-03/msg00223.html</a> - proposal
</UL>
<p>
<H3>math.log10() vs. math.log()</H3>
<p>
math.log10() is deprecated. Use 10 as new second argument of math.log().
<p>
<em>References:</em> (Anyone?)
<p>
<H3>table.maxn() removed</H3>
<p>
table.maxn is deprecated.
<p>
<em>References:</em>
<p>
<UL>
<li> <a href="/lists/lua-l/2004-11/msg00054.html">LuaList:2004-11/msg00054.html</a> - plan table.maxn
<li> <a href="/lists/lua-l/2005-11/msg00008.html">LuaList:2005-11/msg00008.html</a> - announce table.maxn 5.1beta
<li> <a href="/lists/lua-l/2006-01/msg00350.html">LuaList:2006-01/msg00350.html</a> - proposal "maxn considered pointless"
<li> <a href="/lists/lua-l/2006-01/msg00352.html">LuaList:2006-01/msg00352.html</a> - proposal
<li> <a href="/lists/lua-l/2009-11/msg00045.html">LuaList:2009-11/msg00045.html</a> - proposal
</UL>
<p>
<H3>table.unpack() and table.pack()</H3>
<p>
unpack() is renamed to table.unpack(). table.pack() is added, packing arguments to a table and storing number of arguments to table's field "n".
<p>
<em>References:</em>
<p>
<UL>
<li> <a href="/lists/lua-l/2010-01/msg00329.html">LuaList:2010-01/msg00329.html</a> - comments
<li> <a href="/lists/lua-l/2010-01/msg01427.html">LuaList:2010-01/msg01427.html</a> - comments
</UL>
<p>
<H3>Enhanced pipe support</H3>
<p>
If file was opened by io.popen(), file:close() returns process' exit code.
<p>
<em>References:</em>
<p>
<UL>
<li> <a href="/lists/lua-l/2006-04/msg00172.html">LuaList:2006-04/msg00172.html</a> - proposal
<li> <a href="/lists/lua-l/2009-06/msg00124.html">LuaList:2009-06/msg00124.html</a> - proposal
<li> <a href="/lists/lua-l/2009-09/msg00002.html">LuaList:2009-09/msg00002.html</a> - proposal
<li> <a href="http://www.lua.org/work/doc/#changes">[readme]</a> - announced
</UL>
<p>
<H3>Better stopped GC handling</H3>
<p>
Calling collectgarbage("step") no longer restarts GC if it was stopped. Also, you may know if GC was stopped by calling collectgarbage("isrunning"). Of course you may do the same in C API.
<p>
<em>References:</em> (Anyone?)
<p>
<H3>Identifier's locale</H3>
<p>
Lua identifiers may no longer use locale-dependent characters.
<p>
<em>References:</em>
<p>
<UL>
<li> <a href="/lists/lua-l/2009-11/msg00999.html">LuaList:2009-11/msg00999.html</a> - proposal/planned
</UL>
<p>
<H3>New Registry fields</H3>
<p>
The following is a complete list of Lua's use of the registry table (at pseudo-index <code>LUA_REGISTRYINDEX</code>) in the 5.2.0 release.
<p>
Installed by lua_newstate
<p>
<UL>
<li> [1] = &lt;thread&gt; (LUA_RIDX_MAINTHREAD) The main thread of the Lua state containing the registry table.
<li> [2] = &lt;table&gt;  (LUA_RIDX_GLOBALS) The default environment which functions get for globals as _ENV upvalue.
<li> LUA_RIDX_CPCALL in prerelease versions has been retracted. 
<li> Integer keys from [3] up are reserved for allocation by luaL_ref.
</UL>
<p>
Installed by 'package' library loader
<p>
<UL>
<li> ["_LOADED"] = &lt;table&gt; Reference to the table <code>package.loaded</code>
<li> ["_PRELOAD"] = &lt;table&gt; Reference to the table <code>package.preload</code>
<li> ["_LOADLIB"] = &lt;table&gt; Metatable for external 'C' libraries to attach to their library tables.
</UL>
<p>
Installed by 'IO' library loader
<p>
<UL>
<li> ["_IO_output] = &lt;userdata&gt; File descriptor for default output file.
<li> ["_IO_input] = &lt;userdata&gt; File descriptor for default input file.
<li> ["FILE*"] = &lt;table&gt; Metatable for 'file' objects.
</UL>
<p>
The manual states: "As with global names, string keys starting with an underscore followed by uppercase letters are reserved for Lua." Note however that Lua does not rigerously follow this rule as with the "FILE*" key.
<p>
The metatable for strings has not been referenced in the registry, but it simply indexes the string library table itself, so functions added to that will automatically work as methods of string objects.
<p>
<em>References:</em>
<UL>
<li> <a href="http://www.lua.org/manual/5.2/manual.html#4.5">[7]</a> - Lua 5.2 Reference Manual - 4.5 - Registry
</UL>
<p>
<H3>Light C functions / lua_cpcall improvements</H3>
<p>
lua_pushcfunction no longer allocates.  This is more efficient and doesn't raise on failure.  It also eliminates the need for lua_cpcall(), which has been removed from the API.  Furthermore, a version of lua_cpcall supporting multiple arguments and return values is no longer needed either since lua_pcall now can do this.
<p>
<UL>
<li> <a href="/lists/lua-l/2005-02/msg00433.html">LuaList:2005-02/msg00433.html</a> - proposal
<li> <a href="/lists/lua-l/2009-07/msg00417.html">LuaList:2009-07/msg00417.html</a> - proposal (Lua 5.1 implementation)
<li> <a href="/lists/lua-l/2010-01/msg00536.html">LuaList:2010-01/msg00536.html</a> - announce first implementation
<li> <a href="/lists/lua-l/2010-03/msg00271.html">LuaList:2010-03/msg00271.html</a> - comments
<li> <a href="/lists/lua-l/2010-03/msg00409.html">LuaList:2010-03/msg00409.html</a> - comments
<li> <a href="/lists/lua-l/2010-03/msg00942.html">LuaList:2010-03/msg00942.html</a> - comments
<li> <a href="/lists/lua-l/2010-05/msg00331.html">LuaList:2010-05/msg00331.html</a> - announce light C functions
<li> <a href="/lists/lua-l/2010-05/msg00562.html">LuaList:2010-05/msg00562.html</a> - comments
<li> <a href="/lists/lua-l/2010-05/msg00357.html">LuaList:2010-05/msg00357.html</a> - comments
<li> "The Novelties of Lua 5.2" above
</UL>
<p>
<H3>LUA_GLOBALSINDEX removed</H3>
<p>
If you need one, use LUA_RIDX_GLOBALS from the registry (or LUA_ENVIRONINDEX if you didn't changed your C function environment).
<p>
<em>References:</em> (Anyone?)
<p>
<H3>lua_getglobal(), lua_setglobal(), and lua_register()</H3>
<p>
These functions work with C function environment instead of state's global environment to better reflect the way Lua works with global variables.
<p>
<em>References:</em> (Anyone?)
<p>
<H3>luaL_typerror() deprecated</H3>
<p>
<em>References:</em>
<p>
<UL>
<li> <a href="/lists/lua-l/2007-11/msg00023.html">LuaList:2007-11/msg00023.html</a> - proposal to rename to luaL_typeerror
<li> <a href="/lists/lua-l/2010-05/msg00537.html">LuaList:2010-05/msg00537.html</a> - comments
<li> 5.2.0-alpha says "luaL_typerror was deprecated. Write your own version if you need it"
</UL>
<p>
<H3>lua_compare()</H3>
<p>
New function lua_compare() was added to replace deprecated lua_equal() and lua_lessthan().
<p>
<em>References:</em>
<p>
<UL>
<li> <a href="/lists/lua-l/2009-06/msg00418.html">LuaList:2009-06/msg00418.html</a> - proposal
<li> <a href="/lists/lua-l/2010-01/msg00536.html">LuaList:2010-01/msg00536.html</a> - announce
</UL>
<p>
<H3>lua_arith()</H3>
<p>
New function lua_arith() to do arithmetics with Lua values the way Lua does it.
<p>
<em>References:</em>
<p>
<UL>
<li> <a href="/lists/lua-l/2009-06/msg00418.html">LuaList:2009-06/msg00418.html</a> - proposal
<li> <a href="/lists/lua-l/2010-07/msg00123.html">LuaList:2010-07/msg00123.html</a> - question on LUA_OPUNM
<li> <a href="http://www.lua.org/work/diffs-lua-5.2.0-work3-work4.txt">[8]</a> - LUA_OPUNM patched in 5.2.0work4
<li> <a href="http://www.lua.org/work/doc/manual.html#lua_arith">[9]</a> - reference manual
</UL>
<p>
<H3>Object length from C</H3>
<p>
lua_objlen() was renamed to lua_rawlen(). lua_len() was added to honor __len metamethod.
<p>
<em>References:</em>
<p>
<UL>
<li> <a href="/lists/lua-l/2010-01/msg00536.html">LuaList:2010-01/msg00536.html</a> - announce 5.2.0work1
<li> <a href="/lists/lua-l/2010-01/msg00897.html">LuaList:2010-01/msg00897.html</a> - comments
</UL>
<p>
<H3>lua_checkstack() updated</H3>
<p>
lua_checkstack is now only returns error codes (never raises).  Use luaL_checkstack if you want to raise (with error string).
<p>
<em>References:</em>
<p>
<UL>
<li> <a href="/lists/lua-l/2009-07/msg00440.html">LuaList:2009-07/msg00440.html</a> - proposal (others?)
<li> <a href="/lists/lua-l/2010-01/msg00434.html">LuaList:2010-01/msg00434.html</a> - comments, approval
<li> <a href="/lists/lua-l/2010-03/msg00944.html">LuaList:2010-03/msg00944.html</a> - comments, roberto
<li> <a href="/lists/lua-l/2009-03/msg00014.html">LuaList:2009-03/msg00014.html</a> - comments
</UL>
<p>
<H3>lua_pushstring() and lua_pushlstring() enhanced</H3>
<p>
Now they return pointers to the internal string representations.
<p>
<em>References:</em> (Anyone?)
<p>
<H3>lua_copy()</H3>
<p>
Allows to copy Lua values on stack (replacing existing value in the target slot).
<p>
<em>References:</em>
<p>
<UL>
<li> <a href="/lists/lua-l/2010-03/msg00111.html">LuaList:2010-03/msg00111.html</a> - proposal, announce
<li> <a href="/lists/lua-l/2010-01/msg00536.html">LuaList:2010-01/msg00536.html</a> - announce
</UL>
<p>
<H3>Lua runtime version checks</H3>
<p>
Two new functions were added, lua_version() and luaL_checkversion() to let user check runtime versions and address space correctness. This would help to prevent dreaded obscure bugs when several Lua instances are linked to the executable. luaL_checkversion() is called from luaL_register(), so such checks would be performed automatically when most modules are require()-d.
<p>
<em>References:</em>
<p>
<UL>
<li> <a href="/lists/lua-l/2002-12/msg00121.html">LuaList:2002-12/msg00121.html</a> - announce 5.0 beta (later retracted?)
<li> <a href="/lists/lua-l/2009-06/msg00147.html">LuaList:2009-06/msg00147.html</a> - proposal
<li> <a href="/lists/lua-l/2010-01/msg00536.html">LuaList:2010-01/msg00536.html</a> - announce 5.2.0work1
<li> <a href="/lists/lua-l/2010-01/msg01034.html">LuaList:2010-01/msg01034.html</a> - comments
</UL>
<p>
<H3>luaL_traceback()</H3>
<p>
New function to produce stacktraces just like debug.traceback() does.
<p>
<em>References:</em>
<p>
<UL>
<li> <a href="/lists/lua-l/2010-01/msg00294.html">LuaList:2010-01/msg00294.html</a> - comments, approval
<li> <a href="http://www.lua.org/work/doc/manual.html#luaL_traceback">[luaL_traceback]</a> - reference manual draft
</UL>
<p>
<H3>LUA_ERRGCMM and LUA_OK</H3>
<p>
LUA_ERRGCMM is a new runtime error code to signify error in __gc metamethod. LUA_OK was added to keep symmetry and means that all went OK and there were no errors.
<p>
<em>References:</em>
<p>
<UL>
<li> <a href="/lists/lua-l/2010-01/msg00536.html">LuaList:2010-01/msg00536.html</a> - announce
<li> <a href="/lists/lua-l/2010-05/msg00553.html">LuaList:2010-05/msg00553.html</a> - comments
<li> <a href="http://www.lua.org/work/doc/manual.html#luaL_load">[luaL_load]</a><a href="http://www.lua.org/work/doc/manual.html#lua_pcall">[luaL_pcall]</a> - reference manual draft (LUA_OK is in various other places)
</UL>
<p>
<H3>Better dynamic library loading on *nix</H3>
<p>
Now Lua C modules may load dynamic libraries with global symbols (thanks to RTLD_GLOBAL).
<p>
<em>References:</em> (Anyone?)
<p>
<H3>Dynamic library loading on Windows improvements</H3>
<p>
DLL search path handling was improved on Windows.
<p>
<UL>
<li> Supports LUA_LLE_FLAGS=LOAD_WITH_ALTERED_SEARCH_PATH preprocessor option, using <code>LoadLibraryEx</code>.
<li> <a href="../wiki/LoadLibrary.html" >LoadLibrary</a> - has more details, including issues still remaining in 5.2.
</UL>
<p>
<H3>More constants per chunk</H3>
<p>
Maximum number of constants per chunk increased to 2^26 from 2^18. Go, huge table dumps!
<p>
<em>References:</em>
<p>
<UL>
<li> <a href="/lists/lua-l/1999-01/msg00004.html">LuaList:1999-01/msg00004.html</a> - proposal
<li> <a href="/lists/lua-l/1999-07/msg00006.html">LuaList:1999-07/msg00006.html</a> - announce: 2^16 to 2^24 (Lua 3.2)
<li> <a href="/lists/lua-l/2005-03/msg00126.html">LuaList:2005-03/msg00126.html</a> - proposal
<li> <a href="/lists/lua-l/2007-06/msg00220.html">LuaList:2007-06/msg00220.html</a> - proposal
<li> <a href="/lists/lua-l/2008-02/msg00255.html">LuaList:2008-02/msg00255.html</a> - proposal
<li> <a href="/lists/lua-l/2008-05/msg00284.html">LuaList:2008-05/msg00284.html</a> - proposal
<li> <a href="/lists/lua-l/2009-08/msg00099.html">LuaList:2009-08/msg00099.html</a> - proposal
<li> <a href="/lists/lua-l/2010-01/msg00536.html">LuaList:2010-01/msg00536.html</a> - announce: 2^18 to 2^26 (Lua 5.2.0work1)
<li> <a href="/lists/lua-l/2010-03/msg00238.html">LuaList:2010-03/msg00238.html</a> - comments, LuaJIT
</UL>
<p>
<H3>Parser optimizations</H3>
<p>
Parser eats less c-stack space as it no longer uses auto arrays.
<p>
<em>References:</em>
<p>
<UL>
<li> <a href="/lists/lua-l/2001-01/msg00040.html">LuaList:2001-01/msg00040.html</a> - related?
<li> <a href="/lists/lua-l/2010-01/msg00536.html">LuaList:2010-01/msg00536.html</a> - announce
</UL>
<p>
<H3>New floating point hash function</H3>
<p>
New hash function for floating point values to better handle cases when lua_Number is defined as long double on some 64-bit platforms.
<p>
<em>References:</em>
<p>
<UL>
<li> <a href="/lists/lua-l/2010-01/msg00536.html">LuaList:2010-01/msg00536.html</a> - announce
</UL>
<p>
<H3>file:write() improved</H3>
<p>
file:write() returns file to allow chained calls.
<p>
<em>References:</em>
<p>
<UL>
<li> <a href="/lists/lua-l/2010-01/msg00536.html">LuaList:2010-01/msg00536.html</a> - announce
</UL>
<p>
<H3>end-of-line character preservation in new file:read end file:lines</H3>
<p>
A new "*L" option to file:read is like "*l" but keeps end of line (if present).  Also, a new <code>keepNL</code> argument in <code>file:lines</code> keeps new lines.
<p>
<UL>
<li> <a href="/lists/lua-l/2010-02/msg00831.html">LuaList:2010-02/msg00831.html</a> - proposal
<li> <a href="http://www.lua.org/work/doc/manual.html#pdf-file:read">[file:read]</a> - reference manual draft
<li> <a href="http://www.lua.org/work/doc/manual.html#pdf-file:lines">[file:lines]</a> - reference manual draft
</UL>
<p>
<H3>os.exit() improved</H3>
<p>
It may optionally call lua_close() on the Lua state.
<p>
<em>References:</em>
<p>
<UL>
<li> <a href="/lists/lua-l/2010-01/msg00536.html">LuaList:2010-01/msg00536.html</a> - announce
</UL>
<p>
<H3>os.execute() interface change</H3>
<p>
"Function os.execute now returns true when command terminates successfully and nil plus error information otherwise." <a href="http://www.lua.org/manual/5.2/manual.html#8.2">[10]</a>
<p>
<UL>
<li> <a href="http://www.lua.org/manual/5.1/manual.html#pdf-os.execute">[os.execute in 5.1]</a>
<li> <a href="http://www.lua.org/manual/5.2/manual.html#pdf-os.execute">[os.execute in 5.2]</a>
<li> <a href="/lists/lua-l/2011-06/msg00587.html">LuaList:2011-06/msg00587.html</a>
<li> <a href="/lists/lua-l/2004-10/msg00111.html">LuaList:2004-10/msg00111.html</a>
</UL>
<p>
Examples:
<p>
<DL>
<dt><dd><pre>

$ lua51 -e "os.exit(3)"; echo $?

3

$ lua51 -e 'print(os.execute[[lua -e "os.exit(3)"]])'

768

$ lua52  -e 'print(os.execute[[lua -e "os.exit(3)"]])'

nil	exit	3

$ perl -e 'print(system(qq(perl -e "exit(3)")),"\n")'

768

$ python -c "import os; print(os.system(\"python -c 'import os; os._exit(3)'\"))"

768

</pre>
</DL>
<p>
<H3>Call<code></code>Info stack now is a linked list</H3>
<p>
??
<p>
<em>References:</em>
<p>
<UL>
<li> <a href="/lists/lua-l/2010-01/msg00536.html">LuaList:2010-01/msg00536.html</a> - announce
</UL>
<p>
<H3>Resolve module system and module function issues</H3>
<p>
The <code>module/luaL_register</code> functions are deprecated and replaced by luaL_newlib and luaL_setfuncs.  There is also a new function <code>luaL_requiref</code>.
<p>
I believe this is a much more significant change than the manual or other material suggest. On the face of it, where you could previously write <code>require 'coroutine'</code> for example, you now have to write <code>coroutine = require 'coroutine'</code>. This is definitely a useful improvement, but if I have understood it correctly, it will break a lot of existing code. The 'changes' section of the manual is not sufficiently explicit about this. Worse, the documentation for <code>require</code> does not clearly state the purpose of the return value. You have to read between the lines that the intent is to return either the module's global table or the value 'true' if the module does not export a global table (delivering this intent depends on the module loader following some rules, which are not explicitly stated).
<p>
<DL>
<dt><dd>The manual says "Once a loader is found, require calls the loader with two arguments: modname and an extra value dependent on how it got the loader. [...] If the loader returns any non-nil value, require assigns the returned value to package.loaded[modname]. If the loader does not return a non-nil value and has not assigned any value to package.loaded[modname], then require assigns true to this entry. In any case, require returns the final value of package.loaded[modname]."  How is that not clear?  One thing, I might add, however, is that allowing <code>true</code>, rather than a module table, to be assigned to <code>package.loaded[modname]</code> is normally something to be avoided and is rather a fallback behavior, lacking any better value to use, to at least ensure that the module loader isn't executed more than once on multiple require calls.  Now, concerning exactly what the loader should return, it should normally be a table <a href="/lists/lua-l/2008-02/msg01261.html">[21]</a>, but the official Lua reference manual might be silent on this because of the <a href="../wiki/MechanismNotPolicy.html" >MechanismNotPolicy</a> design principle.  Sometimes module loaders return functions (normally object constructors), though perhaps it would be preferable to return <a href="../wiki/FuncTables.html" >FuncTables</a> (i.e. a table with a call operator) since it's quasi-standard for <code>require'foo'._VERSION</code> to represent the module version (<a href="../wiki/ModuleVersioning.html" >ModuleVersioning</a>), which remains possible with <a href="../wiki/FuncTables.html" >FuncTables</a>.  BTW, the <code>module</code> function, though deprecated in 5.2, is still available unless you turn off deprecated features, and the call to <code>module</code> sets <code>package.loaded[modname]</code> (as well as a global).  --<a href="../wiki/DavidManura.html" >DavidManura</a>
</DL>
<p>
Compare <code>luaL_requiref</code> (C API) with <code>require</code> (Lua): the latter just takes the module name, while the former takes the module name, the library loader function and a flag which you set 'true' to store the return from the loader function in a global with the same name as the library. <code>luaL_openlibs</code> uses <code>luaL_requiref</code> with this flag set. Hence it will open the standard libraries with their global tables initialised as expected. However libraries opened from Lua with <code>require</code> must set the global explicitly using the returned value.
<p>
Please feel free to correct the above two paragraphs if they are misconceived!
<p>
<DL>
<dt><dd><code>luaL_requiref</code> I consider to be just a convenience function for certain cases like linit.c.   For example, it assumes the loader is a C function (lua_CFunction) and the destination table is <code>LUA_RIDX_GLOBALS</code>, so it's not entirely general.  The "must set the global explicitly" is not really true since it's normally preferred to set a local explicitly, <code>local foo = require 'foo'</code>, which doesn't tamper with <code>_G</code>.  --<a href="../wiki/DavidManura.html" >DavidManura</a>
</DL>
<p>
<DL>
<DL>
<dt><dd>Sorry <a href="../wiki/DavidManura.html" >DavidManura</a>, I did not really intend to open a policy discussion/critique, just to warn others about a practical problem I just discovered the hard way. My runtime does not load most of the standard libraries by default but instead puts their loader functions in the <code>preloads</code> table (I do this to save RAM). After converting from 5.1.4 to 5.2 I found that Lua with e.g. <code>require 'coroutine'</code> no longer worked and I had to change it to <code>coroutine = require 'coroutine'</code>. This leads to the consideration that, if third-party library developers follow the example (I will not say policy) set by the standard libraries, then they too may break existing Lua code. Most users will not notice this change with respect to the standard libraries because runtimes usually load these by calling <code>luaL_openlibs</code> which in turn calls <code>luaL_requiref</code>. -- <a href="../wiki/JohnHind.html" >JohnHind</a>
</DL>
</DL>
<p>
References:
<p>
<UL>
<li> <a href="../wiki/LuaModuleFunctionCritiqued.html" >LuaModuleFunctionCritiqued</a>
<li> <a href="/lists/lua-l/2010-06/msg00494.html">LuaList:2010-06/msg00494.html</a> - RFC on luaL_register, roberto
<li> <a href="/lists/lua-l/2010-07/msg00862.html">LuaList:2010-07/msg00862.html</a> - announce in 5.2.0work4
<li> "The Novelties of Lua 5.2" above
</UL>
<p>
<H3>Version-specific environment variables</H3>
<p>
Added environmented variables LUA_PATH_5_2, etc.
<p>
<UL>
<li> <a href="/lists/lua-l/2010-07/msg00862.html">LuaList:2010-07/msg00862.html</a> - announce in 5.2.0work4
</UL>
<p>
<hr><H2>What we wouldn't get in 5.2</H2>
<p>
...Or would we?
<p>
<em>You're welcome to put your pet feature here, assuming it was supported by someone else on the list AND was declined by Lua authors for inclusion into 5.2. Please be polite. --<a href="../wiki/AlexanderGladysh.html" >AlexanderGladysh</a></em>
<p>
<H3>string.pack/string.unpack</H3>
<p>
Something along the lines of struct/lpack
<p>
<em>References:</em>
<UL>
<li> <a href="../wiki/StructurePacking.html" >StructurePacking</a> - proposals
<li> <a href="/lists/lua-l/2008-02/msg00729.html">LuaList:2008-02/msg00729.html</a> - comments
</UL>
<p>
<em>Decline motivation:</em> (Have a link?)
<p>
<H3>Token filters</H3>
<p>
Or other "meta" facility.
<p>
<em>References:</em>
<p>
<UL>
<li> <a href="../wiki/MetaProgramming.html" >MetaProgramming</a> - proposals
<li> <a href="/lists/lua-l/2006-10/msg00722.html">LuaList:2006-10/msg00722.html</a> - lhf comment
<li> "The Novelties of Lua 5.2" above
</UL>
<p>
<em>Decline motivation:</em> (Have a link?)
<p>
<H3>#line directive</H3>
<p>
This would be similar to the C preprocessor's <code>#line</code> directive <a href="http://www.cplusplus.com/doc/tutorial/preprocessor/">[11]</a>.  The main motivation is to allow preprocessors to output this in generated Lua code so that debugging line numbers and file names correspond to the original (prior to preprocessing) source code.
<p>
<UL>
<li> <a href="/lists/lua-l/2011-10/msg00770.html">LuaList:2011-10/msg00770.html</a> - discusses patch to Proto (Jensen)
<li> <a href="/lists/lua-l/2011-10/msg00703.html">LuaList:2011-10/msg00703.html</a> - #line mentioned (Donovan)
<li> <a href="/lists/lua-l/2011-09/msg00269.html">LuaList:2011-09/msg00269.html</a> - suggestion for traceback error handler rewriting line numbers instead
<li> <a href="/lists/lua-l/2011-08/msg00332.html">LuaList:2011-08/msg00332.html</a> - Moon<code></code>Script "line number reversal, so errors that happen in the compiled Lua are rewritten to point back to the original Moon<code></code>Script line"
<li> <a href="/lists/lua-l/2011-08/msg00910.html">LuaList:2011-08/msg00910.html</a> - "C preprocessor style #line support".
<li> <a href="/lists/lua-l/2011-08/msg00911.html">LuaList:2011-08/msg00911.html</a> - Mentions problem of "one filename per Proto" restriction.  Also noted by Pall in <a href="/lists/lua-l/2011-10/msg00711.html">LuaList:2011-10/msg00711.html</a> in respect to <a href="../wiki/LuaJit.html" >LuaJit</a>.
<li> <a href="/lists/lua-l/2011-06/msg00772.html">LuaList:2011-06/msg00772.html</a> - relationship to goto/labels.
<li> <a href="/lists/lua-l/2011-06/msg00707.html">LuaList:2011-06/msg00707.html</a> - #line mentioned
<li> <a href="/lists/lua-l/2011-06/msg00586.html">LuaList:2011-06/msg00586.html</a> - #line mentioned (Donovan)
<li> <a href="/lists/lua-l/2011-01/msg01410.html">LuaList:2011-01/msg01410.html</a> - #line mentioned (Donovan)
<li> <a href="/lists/lua-l/2010-02/msg00889.html">LuaList:2010-02/msg00889.html</a> - #line mentioned (Donovan)
<li> <a href="/lists/lua-l/2009-05/msg00288.html">LuaList:2009-05/msg00288.html</a> - <code>__LINE__</code> for <a href="../wiki/SourceOptimizer.html" >SourceOptimizer</a>
<li> <a href="/lists/lua-l/2005-06/msg00111.html">LuaList:2005-06/msg00111.html</a> - Lhf patch to lexer to alter line numbers (but not file names)
<li> <a href="/lists/lua-l/2001-06/msg00131.html">LuaList:2001-06/msg00131.html</a> ; <a href="/lists/lua-l/2001-06/msg00132.html">LuaList:2001-06/msg00132.html</a> - Lhf
</UL>
<p>
<H3>Removal of automatic coercions</H3>
<p>
<UL>
<li> "The Novelties of Lua 5.2" above
</UL>
<p>
<H3>lua_rawtostring / rawtostring</H3>
<p>
Get a string without coercions from numbers.
<p>
<em>References:</em>
<UL>
<li> <a href="https://github.com/dubiousjim/luafiveq">[luafiveqplus]</a> implements this, as "hash.pstring"
<li> <a href="/lists/lua-l/2011-05/msg00028.html">LuaList:2011-05/msg00028.html</a> - "Getting the 'ID' of an object"
<li> <a href="/lists/lua-l/2009-02/msg00421.html">LuaList:2009-02/msg00421.html</a> - "rawtostring()"
<li> <a href="/lists/lua-l/2008-02/msg00768.html">LuaList:2008-02/msg00768.html</a>
<li> <a href="/lists/lua-l/2006-10/msg00005.html">LuaList:2006-10/msg00005.html</a>
<li> <a href="/lists/lua-l/2006-07/msg00003.html">LuaList:2006-07/msg00003.html</a>
<li> <a href="/lists/lua-l/2004-09/msg00421.html">LuaList:2004-09/msg00421.html</a> - "Lua5.1 suggestion: rawtostring()"
<li> <a href="/lists/lua-l/2004-01/msg00173.html">LuaList:2004-01/msg00173.html</a> - "rawtostring()"
</UL>
<p>
<em>Decline motivation:</em> (Have a link?)
<p>
<H3>Hyphens in module names</H3>
<p>
Module version number is currently expected to be on the left side of the name, which is rather unusual.
<p>
<em>References:</em>
<p>
<UL>
<li> <a href="/lists/lua-l/2009-07/msg00074.html">LuaList:2009-07/msg00074.html</a> - planned
</UL>
<p>
<em>Decline motivation:</em> (Have a link?)
<p>
<H3>Improving deterministic resource cleanup</H3>
<p>
<UL>
<li> <a href="http://john.neggie.net/2009/lua/resource_finalization">http://john.neggie.net/2009/lua/resource_finalization</a>
<li> <a href="/lists/lua-l/2009-01/msg00333.html">LuaList:2009-01/msg00333.html</a> - status
</UL>
<p>
<H3>Replace package.seeall with something like package.clean</H3>
<p>
Replace package.seeall with something analogous to the <code>package.clean</code> solutions in <a href="../wiki/ModuleDefinition.html" >ModuleDefinition</a>, but updated to support _ENV.  package.seeall doesn't separate the public module table with the private implementation environment.
<p>
References:
<p>
<UL>
<li> <a href="../wiki/ModuleDefinition.html" >ModuleDefinition</a>
<li> <a href="https://github.com/dubiousjim/luafiveq">[luafiveqplus]</a> implements this
</UL>
<p>
<H2>Suggestions</H2>
<p>
Some features/changes proposed by users for 5.2 are listed in <a href="../wiki/FeatureProposals.html" >FeatureProposals</a>.  Requests should be posted to the mailing list.
<p>
<H2>See Also</H2>
<p>
<UL>
<li> <a href="http://www.lua.org/versions.html">[1]</a> Lua version history
<li> <a href="/lists/lua-l/2008-02/msg00720.html">[22]</a> Initial list of planned changes in 5.2 posted by Roberto Ierusalimschy (2008-02-19)
<li> <a href="../wiki/FeatureProposals.html" >FeatureProposals</a>
<li> The history of Lua (see <a href="http://www.tecgraf.puc-rio.br/~lhf/ftp/doc/hopl.pdf">[The Evolution of Lua]</a>)
<li> <a href="http://www.corsix.org/content/look-lua-52-work3">[A look at Lua 5.2 (work3)]</a> - changes between 5.1 and 5.2-work3 (corsix.org)
<li> <a href="http://batbytes.com/luafaq/#T8">[Lua Unofficial Frequently Asked Questions]</a> - contains section on 5.2
</UL>
<hr>
<a href="../wiki/RecentChanges.html" >RecentChanges</a> &middot; <a href="/cgi-bin/wiki.pl?action=editprefs" >preferences</a><br>
<a href="/cgi-bin/wiki.pl?action=edit&amp;id=LuaFiveTwo" >edit</a> &middot; <a href="/cgi-bin/wiki.pl?action=history&amp;id=LuaFiveTwo" >history</a><br>Last edited May 20, 2012 2:00 am GMT <a href="/cgi-bin/wiki.pl?action=browse&amp;diff=1&amp;id=LuaFiveTwo" >(diff)</a>
</body>
</html>