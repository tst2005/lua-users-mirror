<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML><HEAD><TITLE>lua-users wiki: Lua Module Lzo</TITLE>
<LINK TYPE="text/css" REL="stylesheet" HREF="../styles/main.css">
</HEAD>
<BODY ><table width="100%" border="0"> <tr><td align=left width="100%"><h1><a href="/cgi-bin/wiki.pl?action=search&amp;string=LuaModuleLzo&amp;body=1" title="List pages referring to LuaModuleLzo">Lua Module Lzo</a></h1></td><td align=right>
    <table cellpadding="0" cellspacing="0" border="0" width="1%">
      <tbody>
        <tr>
            <td><a href="../index.html">
            <img src="../images/nav-logo.png" alt="lua-users home" width="177" height="40" border="0"></a></td>
        </tr>
        <tr>
            <td>
            <table cellpadding="0" cellspacing="0" border="0" width="100%">
                <tbody>
                <tr>
                    <td><img src="../images/nav-elbow.png" alt="" width="48" height="40"></td>
                    <td nowrap valign="middle" width="100%">
                        <a href="../wiki/index.html" class="nav">wiki</a></td>
                </tr>
                </tbody>
            </table>
            </td>
        </tr>
      </tbody>
    </table>
<form method="post" action="../wiki/FindPage.html" enctype="application/x-www-form-urlencoded" style="display:inline; margin:0;">
<input type="hidden" name="action" value="search"  /><input type="text" name="string"  size="20" style="" id="search_query1" /><input type="hidden" name="title" value="1"  /><input type="submit" name=".submit" value="Search" /><input type="hidden" name="body" value="on"  /></form></td></tr> </table>
<br clear=all>
Lzo is a Lua module for simple compression and decompression of data via the <a href="http://lzo.sourceforge.net">[miniLZO]</a> library.
<p>
<H3>Description</H3>
<p>
Main goals of the module are:
<p>
<UL>
<li> High (de)compression speed.
<li> Very simple interface: only two functions are exported to Lua.
<li> Small size of binary module: currently less than 15 kB.
<li> Targeted towards Lua 5.0.
</UL>
<p>
<H3>Quick Tips</H3>
<p>
The module is very easy to use, there are only two functions:
<p>
<DL>
<dt><dd><pre class="code">
lzo.compress(str)

lzo.decompress(str)

</pre>

</DL>
<p>
Both take a Lua string as single argument and return another Lua string. Strings passed to <code>lzo.decompress</code> must have a special format, as generated by <code>lzo.compress</code>, otherwise <code>lzo.decompress</code> will produce an error.
<p>
<H3>Example</H3>
<p>
Here's a quick example that opens a file, compressing it to another:
<p>
<DL>
<dt><dd><pre class="code">
input = <span class="library">io.open</span>(<span class="string">"inputfile"</span>, <span class="string">"rb"</span>)

output = <span class="library">io.open</span>(<span class="string">"outputfile"</span>, <span class="string">"wb"</span>)



in_data = input:read(<span class="string">"*a"</span>)

input:close()



out_data= lzo.compress(in_data)



output:write(out_data)

output:close()



<span class="library">print</span>(<span class="library">string.len</span>(in_data) .. <span class="string">" bytes compressed to "</span> ..

      <span class="library">string.len</span>(out_data).. <span class="string">" bytes"</span>)



<span class="comment">-- Let the GC thrash away buffers</span>

in_data = <span class="keyword">nil</span>

out_data= <span class="keyword">nil</span>

</pre>

</DL>
<p>
<H3>Extras</H3>
<p>
miniLZO includes a function to calculate checksums using the adler32 algorithm. In latests versions of the module, I interfaced this function too, so you can call it from Lua as:
<p>
<DL>
<dt><dd><pre class="code">
lzo.adler(num)

</pre>

</DL>
<p>
The number (optional) is the initial value of the sum; if not given a default value of <code>0</code> is used.
<p>
<H3>Author</H3>
<p>
<a href="../wiki/AdrianPerez.html" >AdrianPerez</a>
<p>
<H2>Downloads</H2>
<p>
At this moment it's only available as source code. <strong>Latest version is 0.4</strong>.
<p>
<UL>
<li> Version 0.4 <a href="/files/wiki_insecure/binary_modules/lualzo-0.4.tar.gz">[TGZ package, 33 kB]</a>
<li> Version 0.2 <a href="/files/wiki_insecure/binary_modules/lualzo.tar.gz">[TGZ package, 31 kB]</a>
</UL>
<p>
You will only need Lua 5.0 beta or above, as the miniLZO source is included in the package.
<p>
Current version was tested with MacOS X 10.2 (Jaguar) and Linux. As miniLZO is very portable, it should compile and work in nearly any operating system where Lua is capable of running.
<p>
<H3>Bug Patch</H3>
<p>
This code has bug when compiling in lua 5.0. This is modified version of luaLZO_open()... replace to this.
<p>
<DL>
<dt><dd><pre>

int luaLZO_open(lua_State* L)

{

	ASSERT(L);

	

	if (lzo_init() != LZO_E_OK) {

		luaL_error(L, "failed to initialize the mini-LZO (de)compressor");

	}



	static const luaL_reg lzolib[] = {

	  {"comp", luaLZO_compress},

	  {"decomp", luaLZO_decompress},

	  {"adler", luaLZO_adler},

	  {NULL, NULL}

	};



	luaL_openlib(L, "lzo", lzolib, 0);



	return 0;

}

</pre>
</DL>
<p>
- redpixel (redpixel_at_korea.com)
<p>
<em>Thanks, I'll take care of this in the next release :) -- <a href="../wiki/AdrianPerez.html" >AdrianPerez</a></em>
<hr>
<a href="../wiki/RecentChanges.html" >RecentChanges</a> &middot; <a href="/cgi-bin/wiki.pl?action=editprefs" >preferences</a><br>
<a href="/cgi-bin/wiki.pl?action=edit&amp;id=LuaModuleLzo" >edit</a> &middot; <a href="/cgi-bin/wiki.pl?action=history&amp;id=LuaModuleLzo" >history</a><br>Last edited October 31, 2009 6:32 pm GMT <a href="/cgi-bin/wiki.pl?action=browse&amp;diff=1&amp;id=LuaModuleLzo" >(diff)</a>
</body>
</html>